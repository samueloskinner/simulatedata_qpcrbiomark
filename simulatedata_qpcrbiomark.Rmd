---
title: 'Simulation of Fluidigm Biomark qPCR data - For verification of analysis scripts'
author: "Samuel O Skinner"
date: "March 31, 2017"
output:
  html_document:
    number_sections: yes
---


```{r global_opts, echo=FALSE, cache=FALSE}
knitr::opts_chunk$set(fig.width=8, fig.height=4, fig.align='center',
                      echo=TRUE, warning=FALSE, message=FALSE,
                      cache=FALSE, autodep=TRUE)
# knitr::opts_knit$set(root.dir = "..")

## numbers >= 10^5 will be denoted in scientific notation,
## and rounded to 2 digits
options(scipen = 1, digits = 5)
```

# Setup

## Prepare workspace


``` {r setup}

# R code to start with Fluidigm Ct data and return delta delta Ct values
path<-"~/Box Sync/Projects/Fluidigm_qPCR_analysis/"
directory<-"P142-2_Wambre_IL33_impact"

workdir<-paste(path, directory, "/", sep="")

library(combinat)
library(knitr)
library(shiny)
library(gplots)
library(ggplot2)
library(reshape2)
library(cowplot)
library(sva)

# read in scripts
source(file=paste(workdir,"scripts/","Fluidigm_R_Functions.R",sep=""))
source(file=paste(workdir,"scripts/","Fluidigm_R_HKgenes_Functions.R",sep=""))


``` 

## Load sample data files as a template

``` {r read in parameters, echo=FALSE}

# read in all data files stored in Data directory - do not know how many there will be 
fileNames<-list.files(path=paste(workdir,"DataSubset1/",sep=""))
fileNames<-reorderFileNames(fileNames)

# read in data
dataList<-list()
for (i in 1:length(fileNames))
{
	dataList[[i]]<-readFluidData(paste(workdir,"DataSubset1/",fileNames[i],sep=""))
}
names(dataList)<-fileNames


# now check chamber IDs to make sure samples and genes match across plates
# if they do not match, then stop processing - need to fix the input data
anyError <- checkSampleGeneChamberIDs(dataList)
print(paste("Errors detected:", anyError))


# convert into matrix of rows (assays/genes) and columns (samples represented by chamber IDs)
ctValList<-list()
ctCallList<-list()
for (i in 1:length(dataList))
{
	ctValList[[i]]<-changeFluidFormat(dataList[[i]], colName="Ct.Value")
	ctCallList[[i]]<-changeFluidFormat(dataList[[i]], colName="Ct.Call")
}

# Extract and combine data from multiple plates
retList<-combineDataFromMultiplePlates(dataList, ctValList, ctCallList)

```


